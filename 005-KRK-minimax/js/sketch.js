// Generated by CoffeeScript 2.7.0
var BASE, Board, Button, SIZE, Square, YOFFSET, board, buttons, chess, chess2board, clickedFrom, clickedTo, draw, echo, extractLastMove, fetchAI, getProblem, images, level, mousePressed, mouseReleased, moveNumber, pgn, preload, problemBase, range, setStatus, setup, title,
  indexOf = [].indexOf;

SIZE = 40;

YOFFSET = 40;

BASE = 'Q'; // Hämtas från URL. 

board = null;

chess = new Chess();

level = 1; // fullMoves

moveNumber = 0; // chess.moveNumber verkar inte finnas, får räkna själv

range = _.range;

echo = console.log;

title = null;

pgn = null;

images = {};

clickedFrom = -1;

clickedTo = -1;

problemBase = null;

buttons = [];

chess2board = function() {
  var index, j, len, ref, results, sq;
  ref = range(64);
  results = [];
  for (j = 0, len = ref.length; j < len; j++) {
    index = ref[j];
    sq = chess.board()[7 - Math.floor(index / 8)][index % 8];
    results.push(board.squares[index].piece = sq ? sq.color + sq.type.toUpperCase() : '');
  }
  return results;
};

setStatus = function() {
  var s;
  textSize(18);
  fill('black');
  title = BASE === 'Qr' ? "Win in " : "Mate in ";
  text(title + level, width / 2, 25);
  s = moveNumber === 0 ? "Endbase Exerciser by Christer 2024" : extractLastMove(chess.pgn());
  return text(s, width / 2, 380);
};

getProblem = function(delta) {
  var KkBASE, color, i, indexes, j, len, letter, problem, problems, ref, ref1, results;
  KkBASE = "Kk" + BASE;
  level += delta;
  moveNumber = 0;
  if (level < 1) {
    level = 1;
  }
  if (ref = !level, indexOf.call(problemBase, ref) >= 0) {
    level -= 1;
  }
  problems = problemBase[level].split(' ');
  problem = _.sample(problems);
  indexes = (function() {
    var j, len, ref1, results;
    ref1 = range(KkBASE.length);
    results = [];
    for (j = 0, len = ref1.length; j < len; j++) {
      i = ref1[j];
      results.push(problem.slice(2 * i, 2 * i + 2));
    }
    return results;
  })();
  chess.clear();
  ref1 = range(KkBASE.length);
  results = [];
  for (j = 0, len = ref1.length; j < len; j++) {
    i = ref1[j];
    letter = KkBASE[i];
    color = indexOf.call("KQRBNP", letter) >= 0 ? 'w' : 'b';
    chess.put({
      type: letter.toLowerCase(),
      color: color
    }, indexes[i]);
    chess2board();
    results.push(setStatus());
  }
  return results;
};

preload = function() {
  var black, j, len, letter, ref, results, white;
  if (window.location.href.includes("?base=")) {
    BASE = window.location.href.split("=")[1];
  }
  echo(BASE);
  problemBase = loadJSON(`json/${BASE}.json`);
  ref = "KQRBNP";
  results = [];
  for (j = 0, len = ref.length; j < len; j++) {
    letter = ref[j];
    black = 'b' + letter;
    white = 'w' + letter;
    images[black] = loadImage(`img/${black}.png`);
    results.push(images[white] = loadImage(`img/${white}.png`));
  }
  return results;
};

setup = function() {
  createCanvas(8 * SIZE, 700);
  textAlign(CENTER, CENTER);
  board = new Board();
  title = createDiv();
  title.position(25, 12.5 * SIZE);
  pgn = createDiv('');
  pgn.position(25, 13 * SIZE);
  getProblem(0);
  buttons.push(new Button('Q', width / 2, 0, 100, 40));
  buttons.push(new Button('R', width / 2, 50, 100, 40));
  buttons.push(new Button('Qr', width / 2, 100, 100, 40));
  buttons.push(new Button('BB', width / 2, 150, 100, 40));
  buttons.push(new Button('BN', width / 2, 200, 100, 40));
  return buttons.push(new Button('NNN', width / 2, 250, 100, 40));
};

Button = class Button {
  constructor(piece1, x1, y1, w, h) {
    var color, j, len, letter, piece, ref;
    this.piece = piece1;
    this.x = x1;
    this.y = y1;
    this.w = w;
    this.h = h;
    this.images = [];
    ref = this.piece;
    for (j = 0, len = ref.length; j < len; j++) {
      letter = ref[j];
      color = indexOf.call("KQRBNP", letter) >= 0 ? 'w' : 'b';
      piece = letter.toUpperCase();
      this.images.push(images[color + piece]);
    }
    this.XOFFSET = -20 * this.images.length;
  }

  draw() {
    var i, j, len, ref, results;
    ref = range(this.images.length);
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      results.push(image(this.images[i], this.XOFFSET + this.x + 40 * i, YOFFSET + 360 + this.y, SIZE, SIZE));
    }
    return results;
  }

  inside(x, y) {
    var ref, ref1;
    return (this.x < (ref = x - this.XOFFSET) && ref < this.x + this.w) && (this.y < (ref1 = y - YOFFSET - 360) && ref1 < this.y + this.h);
  }

  click() {
    return window.location.href = "?base=" + this.piece;
  }

};

Square = class Square {
  constructor(index1, click) {
    this.index = index1;
    this.click = click;
    this.piece = "";
    this.i = this.index % 8;
    this.j = Math.floor(this.index / 8);
    this.x = this.i * SIZE;
    this.y = (7 - this.j) * SIZE;
    this.name = "abcdefgh"[this.i] + "12345678"[this.j];
  }

  // @moving = false
  draw() {
    fill((this.i + this.j) % 2 === 0 ? 'gray' : 'yellow');
    rect(this.x, YOFFSET + this.y, SIZE, SIZE);
    if (clickedFrom !== this.index) { //and clickedTo == -1
      if (this.piece !== '') {
        return image(images[this.piece], this.x, YOFFSET + this.y, SIZE, SIZE);
      }
    }
  }

  inside(x, y) {
    var ref;
    return (this.x < x && x < this.x + SIZE) && (this.y < (ref = y - YOFFSET) && ref < this.y + SIZE);
  }

};

Board = class Board {
  constructor() {
    var i, j, len, ref;
    this.squares = [];
    ref = range(64);
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      this.squares.push(new Square(i));
    }
  }

  draw() {
    var j, len, ref, results, square;
    ref = this.squares;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      square = ref[j];
      results.push(square.draw());
    }
    return results;
  }

  mousePressed() {
    var j, len, ref, results, square;
    ref = board.squares;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      square = ref[j];
      if (square.inside(mouseX, mouseY)) {
        clickedFrom = square.index;
        results.push(echo('moving', clickedFrom));
      } else {
        results.push(void 0);
      }
    }
    return results;
  }

  mouseReleased() {
    var a, b, j, len, move, moves, ref, ref1, square;
    // if clickedFrom == -1 then return
    moves = (function() {
      var j, len, ref, results;
      ref = chess.moves({
        verbose: true
      });
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        move = ref[j];
        results.push(move.from + move.to);
      }
      return results;
    })();
    if (moves.length === 0) {
      getProblem(0);
      return;
    }
    ref = this.squares;
    for (j = 0, len = ref.length; j < len; j++) {
      square = ref[j];
      if (square.inside(mouseX, mouseY)) {
        clickedTo = square.index;
        a = this.squares[clickedFrom].name;
        b = square.name;
      }
    }
    if (ref1 = a + b, indexOf.call(moves, ref1) >= 0) {
      chess.move({
        from: a,
        to: b
      });
      moveNumber += 1;
      fetchAI();
    }
    return clickedFrom = -1;
  }

};

draw = function() {
  var button, j, len, square;
  background('green');
  for (j = 0, len = buttons.length; j < len; j++) {
    button = buttons[j];
    button.draw();
  }
  board.draw();
  setStatus();
  if (clickedFrom !== -1) {
    square = board.squares[clickedFrom];
    //for square in board.squares
    // echo board.squares[clickedFrom]
    echo(square.piece);
    return image(images[square.piece], mouseX - SIZE / 2, mouseY - SIZE / 2, SIZE, SIZE);
  }
};

//else
//    if @piece != ''  then image images[@piece],@x,YOFFSET+@y,SIZE,SIZE
mousePressed = function() {
  var button, j, len;
  for (j = 0, len = buttons.length; j < len; j++) {
    button = buttons[j];
    if (button.inside(mouseX, mouseY)) {
      button.click();
      return;
    }
  }
  return board.mousePressed();
};

mouseReleased = function() {
  return board.mouseReleased();
};

extractLastMove = function(s) {
  s = s.split("\n").slice(-2).join(' ');
  return s.split(' ').slice(-3).join(' ');
};

fetchAI = function() {
  return fetch('http://tablebase.lichess.ovh/standard?fen=' + chess.fen()).then((response) => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  }).then((data) => {
    echo(data);
    if (data.category === "draw") {
      return getProblem(-1);
    }
    if (data.moves.length === 0) {
      if (level < moveNumber) {
        return getProblem(-1);
      } else {
        return getProblem(+1);
      }
    }
    chess.move(data.moves[0].san);
    chess2board();
    return setStatus();
  }).catch((error) => {
    return echo('Fetch error:', error);
  });
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6Ii4uXFwiLCJzb3VyY2VzIjpbImNvZmZlZVxcc2tldGNoLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLE9BQUEsRUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsV0FBQSxFQUFBLFNBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLGVBQUEsRUFBQSxPQUFBLEVBQUEsVUFBQSxFQUFBLE1BQUEsRUFBQSxLQUFBLEVBQUEsWUFBQSxFQUFBLGFBQUEsRUFBQSxVQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxXQUFBLEVBQUEsS0FBQSxFQUFBLFNBQUEsRUFBQSxLQUFBLEVBQUEsS0FBQTtFQUFBOztBQUFBLElBQUEsR0FBTzs7QUFDUCxPQUFBLEdBQVU7O0FBRVYsSUFBQSxHQUFPLElBSFA7O0FBS0EsS0FBQSxHQUFROztBQUNSLEtBQUEsR0FBUSxJQUFJLEtBQUosQ0FBQTs7QUFDUixLQUFBLEdBQVEsRUFQUjs7QUFRQSxVQUFBLEdBQWEsRUFSYjs7QUFVQSxLQUFBLEdBQVEsQ0FBQyxDQUFDOztBQUNWLElBQUEsR0FBTyxPQUFPLENBQUM7O0FBRWYsS0FBQSxHQUFROztBQUNSLEdBQUEsR0FBTTs7QUFFTixNQUFBLEdBQVMsQ0FBQTs7QUFFVCxXQUFBLEdBQWMsQ0FBQzs7QUFDZixTQUFBLEdBQVksQ0FBQzs7QUFFYixXQUFBLEdBQWM7O0FBRWQsT0FBQSxHQUFVOztBQUVWLFdBQUEsR0FBYyxRQUFBLENBQUEsQ0FBQTtBQUNkLE1BQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtBQUFJO0FBQUE7RUFBQSxLQUFBLHFDQUFBOztJQUNJLEVBQUEsR0FBSyxLQUFLLENBQUMsS0FBTixDQUFBLENBQWEsQ0FBQyxDQUFB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QixDQUFDLElBQXZCLENBQTRCLEdBQTVCO0FBRmM7O0FBSWxCLE9BQUEsR0FBVSxRQUFBLENBQUEsQ0FBQTtTQUNOLEtBQUEsQ0FBTSw0Q0FBQSxHQUErQyxLQUFLLENBQUMsR0FBTixDQUFBLENBQXJELENBQ0ksQ0FBQyxJQURMLENBQ1UsQ0FBQyxRQUFELENBQUEsR0FBQTtJQUNGLElBQUcsQ0FBQyxRQUFRLENBQUMsRUFBYjtNQUFxQixNQUFNLElBQUksS0FBSixDQUFVLDZCQUFWLEVBQTNCOztBQUNBLFdBQU8sUUFBUSxDQUFDLElBQVQsQ0FBQTtFQUZMLENBRFYsQ0FJSSxDQUFDLElBSkwsQ0FJVSxDQUFDLElBQUQsQ0FBQSxHQUFBO0lBQ0YsSUFBQSxDQUFLLElBQUw7SUFDQSxJQUFHLElBQUksQ0FBQyxRQUFMLEtBQWlCLE1BQXBCO0FBQWdDLGFBQU8sVUFBQSxDQUFXLENBQUMsQ0FBWixFQUF2Qzs7SUFDQSxJQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBWCxLQUFxQixDQUF4QjtNQUNJLElBQUcsS0FBQSxHQUFRLFVBQVg7QUFDSSxlQUFPLFVBQUEsQ0FBVyxDQUFDLENBQVosRUFEWDtPQUFBLE1BQUE7QUFHSSxlQUFPLFVBQUEsQ0FBVyxDQUFDLENBQVosRUFIWDtPQURKOztJQUtBLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFELENBQUcsQ0FBQyxHQUF6QjtJQUNBLFdBQUEsQ0FBQTtXQUNBLFNBQUEsQ0FBQTtFQVZFLENBSlYsQ0FlSSxDQUFDLEtBZkwsQ0FlVyxDQUFDLEtBQUQsQ0FBQSxHQUFBO1dBQVcsSUFBQSxDQUFLLGNBQUwsRUFBcUIsS0FBckI7RUFBWCxDQWZYO0FBRE0iLCJzb3VyY2VzQ29udGVudCI6WyJTSVpFID0gNDBcclxuWU9GRlNFVCA9IDQwXHJcblxyXG5CQVNFID0gJ1EnICMgSMOkbXRhcyBmcsOlbiBVUkwuIFxyXG5cclxuYm9hcmQgPSBudWxsXHJcbmNoZXNzID0gbmV3IENoZXNzKClcclxubGV2ZWwgPSAxICMgZnVsbE1vdmVzXHJcbm1vdmVOdW1iZXIgPSAwICMgY2hlc3MubW92ZU51bWJlciB2ZXJrYXIgaW50ZSBmaW5uYXMsIGbDpXIgcsOka25hIHNqw6RsdlxyXG5cclxucmFuZ2UgPSBfLnJhbmdlXHJcbmVjaG8gPSBjb25zb2xlLmxvZ1xyXG5cclxudGl0bGUgPSBudWxsXHJcbnBnbiA9IG51bGxcclxuXHJcbmltYWdlcyA9IHt9XHJcblxyXG5jbGlja2VkRnJvbSA9IC0xXHJcbmNsaWNrZWRUbyA9IC0xXHJcblxyXG5wcm9ibGVtQmFzZSA9IG51bGwgXHJcblxyXG5idXR0b25zID0gW11cclxuXHJcbmNoZXNzMmJvYXJkID0gLT5cclxuICAgIGZvciBpbmRleCBpbiByYW5nZSA2NFxyXG4gICAgICAgIHNxID0gY2hlc3MuYm9hcmQoKVs3IC0gaW5kZXggLy8gOF1baW5kZXggJSA4XVxyXG4gICAgICAgIGJvYXJkLnNxdWFyZXNbaW5kZXhdLnBpZWNlID0gaWYgc3EgdGhlbiBzcS5jb2xvciArIHNxLnR5cGUudG9VcHBlckNhc2UoKSBlbHNlICcnXHJcblxyXG5zZXRTdGF0dXMgPSAtPlxyXG4gICAgdGV4dFNpemUgMThcclxuICAgIGZpbGwgJ2JsYWNrJ1xyXG4gICAgdGl0bGUgPSBpZiBCQVNFPT0nUXInIHRoZW4gXCJXaW4gaW4gXCIgZWxzZSBcIk1hdGUgaW4gXCJcclxuICAgIHRleHQgdGl0bGUrbGV2ZWwsIHdpZHRoLzIsMjVcclxuICAgIHMgPSBpZiBtb3ZlTnVtYmVyID09IDAgdGhlbiBcIkVuZGJhc2UgRXhlcmNpc2VyIGJ5IENocmlzdGVyIDIwMjRcIiBlbHNlIGV4dHJhY3RMYXN0TW92ZSBjaGVzcy5wZ24oKVxyXG4gICAgdGV4dCBzLHdpZHRoLzIsMzgwXHJcblxyXG5nZXRQcm9ibGVtID0gKGRlbHRhKSAtPlxyXG4gICAgS2tCQVNFID0gXCJLa1wiICsgQkFTRVxyXG4gICAgbGV2ZWwgKz0gZGVsdGFcclxuICAgIG1vdmVOdW1iZXIgPSAwXHJcbiAgICBpZiBsZXZlbCA8IDEgdGhlbiBsZXZlbCA9IDFcclxuICAgIGlmIG5vdCBsZXZlbCBpbiBwcm9ibGVtQmFzZSB0aGVuIGxldmVsIC09IDFcclxuICAgIHByb2JsZW1zID0gcHJvYmxlbUJhc2VbbGV2ZWxdLnNwbGl0ICcgJ1xyXG4gICAgcHJvYmxlbSA9IF8uc2FtcGxlIHByb2JsZW1zXHJcbiAgICBpbmRleGVzID0gKHByb2JsZW0uc2xpY2UgMippLDIqaSsyIGZvciBpIGluIHJhbmdlIEtrQkFTRS5sZW5ndGgpXHJcbiAgICBjaGVzcy5jbGVhcigpXHJcbiAgICBmb3IgaSBpbiByYW5nZSBLa0JBU0UubGVuZ3RoXHJcbiAgICAgICAgbGV0dGVyID0gS2tCQVNFW2ldXHJcbiAgICAgICAgY29sb3IgPSBpZiBsZXR0ZXIgaW4gXCJLUVJCTlBcIiB0aGVuICd3JyBlbHNlICdiJ1xyXG4gICAgICAgIGNoZXNzLnB1dCB7dHlwZTpsZXR0ZXIudG9Mb3dlckNhc2UoKSwgY29sb3I6Y29sb3J9LCBpbmRleGVzW2ldXHJcbiAgICAgICAgY2hlc3MyYm9hcmQoKVxyXG4gICAgICAgIHNldFN0YXR1cygpXHJcblxyXG5wcmVsb2FkID0gLT5cclxuICAgIGlmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzIFwiP2Jhc2U9XCIgdGhlbiBCQVNFID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoXCI9XCIpWzFdXHJcbiAgICBlY2hvIEJBU0VcclxuICAgIHByb2JsZW1CYXNlID0gbG9hZEpTT04gXCJqc29uLyN7QkFTRX0uanNvblwiXHJcbiAgICBmb3IgbGV0dGVyIGluIFwiS1FSQk5QXCJcclxuICAgICAgICBibGFjayA9ICdiJytsZXR0ZXJcclxuICAgICAgICB3aGl0ZSA9ICd3JytsZXR0ZXJcclxuICAgICAgICBpbWFnZXNbYmxhY2tdID0gbG9hZEltYWdlIFwiaW1nLyN7YmxhY2t9LnBuZ1wiXHJcbiAgICAgICAgaW1hZ2VzW3doaXRlXSA9IGxvYWRJbWFnZSBcImltZy8je3doaXRlfS5wbmdcIlxyXG5cclxuc2V0dXAgPSAtPlxyXG4gICAgY3JlYXRlQ2FudmFzIDgqU0laRSwgNzAwXHJcblxyXG4gICAgdGV4dEFsaWduIENFTlRFUixDRU5URVJcclxuXHJcbiAgICBib2FyZCA9IG5ldyBCb2FyZCgpXHJcbiAgICB0aXRsZSA9IGNyZWF0ZURpdigpXHJcbiAgICB0aXRsZS5wb3NpdGlvbiAyNSwgMTIuNSpTSVpFXHJcbiAgICBwZ24gPSBjcmVhdGVEaXYgJydcclxuICAgIHBnbi5wb3NpdGlvbiAyNSwgMTMqU0laRVxyXG4gICAgZ2V0UHJvYmxlbSAwXHJcblxyXG4gICAgYnV0dG9ucy5wdXNoIG5ldyBCdXR0b24gJ1EnLHdpZHRoLzIsMCwxMDAsNDBcclxuICAgIGJ1dHRvbnMucHVzaCBuZXcgQnV0dG9uICdSJyx3aWR0aC8yLDUwLDEwMCw0MFxyXG4gICAgYnV0dG9ucy5wdXNoIG5ldyBCdXR0b24gJ1FyJyx3aWR0aC8yLDEwMCwxMDAsNDBcclxuICAgIGJ1dHRvbnMucHVzaCBuZXcgQnV0dG9uICdCQicsd2lkdGgvMiwxNTAsMTAwLDQwXHJcbiAgICBidXR0b25zLnB1c2ggbmV3IEJ1dHRvbiAnQk4nLHdpZHRoLzIsMjAwLDEwMCw0MFxyXG4gICAgYnV0dG9ucy5wdXNoIG5ldyBCdXR0b24gJ05OTicsd2lkdGgvMiwyNTAsMTAwLDQwXHJcblxyXG5jbGFzcyBCdXR0b25cclxuICAgIGNvbnN0cnVjdG9yIDogKEBwaWVjZSxAeCxAeSxAdyxAaCkgLT5cclxuICAgICAgICBAaW1hZ2VzID0gW11cclxuICAgICAgICBmb3IgbGV0dGVyIGluIEBwaWVjZVxyXG4gICAgICAgICAgICBjb2xvciA9IGlmIGxldHRlciBpbiBcIktRUkJOUFwiIHRoZW4gJ3cnIGVsc2UgJ2InXHJcbiAgICAgICAgICAgIHBpZWNlID0gbGV0dGVyLnRvVXBwZXJDYXNlKClcclxuICAgICAgICAgICAgQGltYWdlcy5wdXNoIGltYWdlc1tjb2xvciArIHBpZWNlXVxyXG4gICAgICAgIEBYT0ZGU0VUID0gLTIwICogQGltYWdlcy5sZW5ndGhcclxuICAgIGRyYXcgOiAtPlxyXG4gICAgICAgIGZvciBpIGluIHJhbmdlIEBpbWFnZXMubGVuZ3RoXHJcbiAgICAgICAgICAgIGltYWdlIEBpbWFnZXNbaV0sQFhPRkZTRVQrQHgrNDAqaSxZT0ZGU0VUKzM2MCtAeSxTSVpFLFNJWkVcclxuICAgICAgICAgICAgXHJcbiAgICBpbnNpZGU6ICh4LHkpIC0+IEB4IDwgeC1AWE9GRlNFVCA8IEB4K0B3IGFuZCBAeSA8IHktWU9GRlNFVC0zNjAgPCBAeStAaFxyXG4gICAgY2xpY2sgOiAtPiB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiP2Jhc2U9XCIgKyBAcGllY2VcclxuXHJcbmNsYXNzIFNxdWFyZVxyXG4gICAgY29uc3RydWN0b3IgOiAoQGluZGV4LEBjbGljaykgLT5cclxuICAgICAgICBAcGllY2UgPSBcIlwiXHJcbiAgICAgICAgQGkgPSBAaW5kZXggJSA4XHJcbiAgICAgICAgQGogPSBAaW5kZXggLy8gOFxyXG4gICAgICAgIEB4ID0gQGkgKiBTSVpFXHJcbiAgICAgICAgQHkgPSAoNy1AaikgKiBTSVpFXHJcbiAgICAgICAgQG5hbWUgPSBcImFiY2RlZmdoXCJbQGldICsgXCIxMjM0NTY3OFwiW0BqXVxyXG4gICAgICAgICMgQG1vdmluZyA9IGZhbHNlXHJcbiAgICBkcmF3IDogLT5cclxuICAgICAgICBmaWxsIGlmIChAaStAaikgJSAyID09IDAgdGhlbiAnZ3JheScgZWxzZSAneWVsbG93J1xyXG4gICAgICAgIHJlY3QgQHgsWU9GRlNFVCtAeSxTSVpFLFNJWkVcclxuXHJcbiAgICAgICAgaWYgY2xpY2tlZEZyb20gIT0gQGluZGV4ICNhbmQgY2xpY2tlZFRvID09IC0xXHJcbiAgICAgICAgICAgIGlmIEBwaWVjZSAhPSAnJyAgdGhlbiBpbWFnZSBpbWFnZXNbQHBpZWNlXSxAeCxZT0ZGU0VUK0B5LFNJWkUsU0laRVxyXG5cclxuICAgIGluc2lkZTogKHgseSkgLT4gQHggPCB4IDwgQHgrU0laRSBhbmQgQHkgPCB5LVlPRkZTRVQgPCBAeStTSVpFXHJcblxyXG5jbGFzcyBCb2FyZFxyXG4gICAgY29uc3RydWN0b3IgOiAtPlxyXG4gICAgICAgIEBzcXVhcmVzID0gW11cclxuICAgICAgICBmb3IgaSBpbiByYW5nZSA2NFxyXG4gICAgICAgICAgICBAc3F1YXJlcy5wdXNoIG5ldyBTcXVhcmUoaSlcclxuICAgIGRyYXcgOiAtPlxyXG4gICAgICAgIGZvciBzcXVhcmUgaW4gQHNxdWFyZXNcclxuICAgICAgICAgICAgc3F1YXJlLmRyYXcoKVxyXG4gICAgbW91c2VQcmVzc2VkIDogLT5cclxuICAgICAgICBmb3Igc3F1YXJlIGluIGJvYXJkLnNxdWFyZXNcclxuICAgICAgICAgICAgaWYgc3F1YXJlLmluc2lkZSBtb3VzZVgsbW91c2VZXHJcbiAgICAgICAgICAgICAgICBjbGlja2VkRnJvbSA9IHNxdWFyZS5pbmRleFxyXG4gICAgICAgICAgICAgICAgZWNobyAnbW92aW5nJyxjbGlja2VkRnJvbVxyXG4gICAgbW91c2VSZWxlYXNlZCA6IC0+XHJcbiAgICAgICAgIyBpZiBjbGlja2VkRnJvbSA9PSAtMSB0aGVuIHJldHVyblxyXG4gICAgICAgIG1vdmVzID0gKG1vdmUuZnJvbSArIG1vdmUudG8gZm9yIG1vdmUgaW4gY2hlc3MubW92ZXMgeyB2ZXJib3NlOiB0cnVlIH0pXHJcbiAgICAgICAgaWYgbW92ZXMubGVuZ3RoID09IDBcclxuICAgICAgICAgICAgZ2V0UHJvYmxlbSAwXHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIGZvciBzcXVhcmUgaW4gQHNxdWFyZXNcclxuICAgICAgICAgICAgaWYgc3F1YXJlLmluc2lkZSBtb3VzZVgsbW91c2VZXHJcbiAgICAgICAgICAgICAgICBjbGlja2VkVG8gPSBzcXVhcmUuaW5kZXhcclxuICAgICAgICAgICAgICAgIGEgPSBAc3F1YXJlc1tjbGlja2VkRnJvbV0ubmFtZVxyXG4gICAgICAgICAgICAgICAgYiA9IHNxdWFyZS5uYW1lXHJcbiAgICAgICAgaWYgYSArIGIgaW4gbW92ZXNcclxuICAgICAgICAgICAgY2hlc3MubW92ZSB7IGZyb206IGEsIHRvOiBiIH1cclxuICAgICAgICAgICAgbW92ZU51bWJlciArPSAxXHJcbiAgICAgICAgICAgIGZldGNoQUkoKVxyXG4gICAgICAgIGNsaWNrZWRGcm9tID0gLTFcclxuXHJcbmRyYXcgPSAtPiBcclxuICAgIGJhY2tncm91bmQgJ2dyZWVuJ1xyXG4gICAgZm9yIGJ1dHRvbiBpbiBidXR0b25zXHJcbiAgICAgICAgYnV0dG9uLmRyYXcoKVxyXG4gICAgYm9hcmQuZHJhdygpXHJcbiAgICBzZXRTdGF0dXMoKVxyXG5cclxuICAgIGlmIGNsaWNrZWRGcm9tICE9IC0xXHJcbiAgICAgICAgc3F1YXJlID0gYm9hcmQuc3F1YXJlc1tjbGlja2VkRnJvbV1cclxuICAgICAgICAjZm9yIHNxdWFyZSBpbiBib2FyZC5zcXVhcmVzXHJcbiAgICAgICAgIyBlY2hvIGJvYXJkLnNxdWFyZXNbY2xpY2tlZEZyb21dXHJcbiAgICAgICAgZWNobyBzcXVhcmUucGllY2VcclxuICAgICAgICBpbWFnZSBpbWFnZXNbc3F1YXJlLnBpZWNlXSwgbW91c2VYLVNJWkUvMiwgbW91c2VZLVNJWkUvMiwgU0laRSxTSVpFXHJcbiNlbHNlXHJcbiMgICAgaWYgQHBpZWNlICE9ICcnICB0aGVuIGltYWdlIGltYWdlc1tAcGllY2VdLEB4LFlPRkZTRVQrQHksU0laRSxTSVpFXHJcblxyXG5cclxubW91c2VQcmVzc2VkID0gLT4gXHJcbiAgICBmb3IgYnV0dG9uIGluIGJ1dHRvbnNcclxuICAgICAgICBpZiBidXR0b24uaW5zaWRlIG1vdXNlWCwgbW91c2VZXHJcbiAgICAgICAgICAgIGJ1dHRvbi5jbGljaygpXHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgYm9hcmQubW91c2VQcmVzc2VkKClcclxubW91c2VSZWxlYXNlZCA9IC0+IGJvYXJkLm1vdXNlUmVsZWFzZWQoKVxyXG5cclxuZXh0cmFjdExhc3RNb3ZlID0gKHMpIC0+XHJcbiAgICBzID0gcy5zcGxpdChcIlxcblwiKS5zbGljZSgtMikuam9pbignICcpXHJcbiAgICBzLnNwbGl0KCcgJykuc2xpY2UoLTMpLmpvaW4gJyAnXHJcbiAgICBcclxuZmV0Y2hBSSA9IC0+IFxyXG4gICAgZmV0Y2ggJ2h0dHA6Ly90YWJsZWJhc2UubGljaGVzcy5vdmgvc3RhbmRhcmQ/ZmVuPScgKyBjaGVzcy5mZW4oKVxyXG4gICAgICAgIC50aGVuIChyZXNwb25zZSkgPT4gXHJcbiAgICAgICAgICAgIGlmICFyZXNwb25zZS5vayB0aGVuIHRocm93IG5ldyBFcnJvciAnTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rJ1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpXHJcbiAgICAgICAgLnRoZW4gKGRhdGEpID0+XHJcbiAgICAgICAgICAgIGVjaG8gZGF0YVxyXG4gICAgICAgICAgICBpZiBkYXRhLmNhdGVnb3J5ID09IFwiZHJhd1wiIHRoZW4gcmV0dXJuIGdldFByb2JsZW0gLTFcclxuICAgICAgICAgICAgaWYgZGF0YS5tb3Zlcy5sZW5ndGggPT0gMFxyXG4gICAgICAgICAgICAgICAgaWYgbGV2ZWwgPCBtb3ZlTnVtYmVyXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByb2JsZW0gLTFcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJvYmxlbSArMVxyXG4gICAgICAgICAgICBjaGVzcy5tb3ZlIGRhdGEubW92ZXNbMF0uc2FuXHJcbiAgICAgICAgICAgIGNoZXNzMmJvYXJkKClcclxuICAgICAgICAgICAgc2V0U3RhdHVzKClcclxuICAgICAgICAuY2F0Y2ggKGVycm9yKSA9PiBlY2hvICdGZXRjaCBlcnJvcjonLCBlcnJvclxyXG4iXX0=
//# sourceURL=c:\github\2024\005-KRK-minimax\coffee\sketch.coffee