// Generated by CoffeeScript 2.7.0
var BASE, Board, Button, SIZE, Square, YOFFSET, board, buttons, chess, chess2board, clickedFrom, clickedTo, draw, echo, extractLastMove, fetchAI, getProblem, images, level, mousePressed, mouseReleased, moveNumber, pgn, preload, problemBase, range, setStatus, setup, title,
  indexOf = [].indexOf;

SIZE = 40;

YOFFSET = 40;

BASE = 'KQk'; // Hämtas från URL.

board = null;

chess = new Chess();

level = 1; // fullMoves

moveNumber = 0; // chess.moveNumber verkar inte finnas, får räkna själv

range = _.range;

echo = console.log;

title = null;

pgn = null;

images = {};

clickedFrom = -1;

clickedTo = -1;

problemBase = null;

buttons = [];

chess2board = function() {
  var index, j, len, ref, results, sq;
  ref = range(64);
  results = [];
  for (j = 0, len = ref.length; j < len; j++) {
    index = ref[j];
    sq = chess.board()[7 - Math.floor(index / 8)][index % 8];
    results.push(board.squares[index].piece = sq ? sq.color + sq.type.toUpperCase() : '');
  }
  return results;
};

setStatus = function() {
  var s;
  textSize(20);
  fill('black');
  text("Mate in " + level, width / 2, 25);
  s = moveNumber === 0 ? "Endbase Exerciser by Christer" : extractLastMove(chess.pgn());
  return text(s, width / 2, 380);
};

getProblem = function(delta) {
  var color, i, indexes, j, len, letter, problem, problems, ref, ref1, results;
  level += delta;
  moveNumber = 0;
  if (level < 1) {
    level = 1;
  }
  if (ref = !level, indexOf.call(problemBase, ref) >= 0) {
    level -= 1;
  }
  problems = problemBase[level].split(' ');
  problem = _.sample(problems);
  indexes = (function() {
    var j, len, ref1, results;
    ref1 = range(BASE.length);
    results = [];
    for (j = 0, len = ref1.length; j < len; j++) {
      i = ref1[j];
      results.push(problem.slice(2 * i, 2 * i + 2));
    }
    return results;
  })();
  chess.clear();
  ref1 = range(BASE.length);
  results = [];
  for (j = 0, len = ref1.length; j < len; j++) {
    i = ref1[j];
    letter = BASE[i];
    color = indexOf.call("KQRBNP", letter) >= 0 ? 'w' : 'b';
    chess.put({
      type: letter.toLowerCase(),
      color: color
    }, indexes[i]);
    chess2board();
    results.push(setStatus());
  }
  return results;
};

preload = function() {
  var black, j, len, letter, ref, results, white;
  if (window.location.href.includes("?base=")) {
    BASE = window.location.href.split("=")[1];
  }
  echo(BASE);
  problemBase = loadJSON(`json/${BASE}.json`);
  ref = "KQRBNP";
  results = [];
  for (j = 0, len = ref.length; j < len; j++) {
    letter = ref[j];
    black = 'b' + letter;
    white = 'w' + letter;
    images[black] = loadImage(`img/${black}.png`);
    results.push(images[white] = loadImage(`img/${white}.png`));
  }
  return results;
};

setup = function() {
  createCanvas(8 * SIZE, 700);
  textAlign(CENTER, CENTER);
  board = new Board();
  title = createDiv();
  title.position(25, 12.5 * SIZE);
  pgn = createDiv('');
  pgn.position(25, 13 * SIZE);
  getProblem(0);
  buttons.push(new Button('KQk', width / 2, 0, 100, 40));
  buttons.push(new Button('KRk', width / 2, 50, 100, 40));
  buttons.push(new Button('KQkr', width / 2, 100, 100, 40));
  buttons.push(new Button('KBBk', width / 2, 150, 100, 40));
  buttons.push(new Button('KBNk', width / 2, 200, 100, 40));
  return buttons.push(new Button('KNNNk', width / 2, 250, 100, 40));
};

Button = class Button {
  constructor(piece1, x1, y1, w, h) {
    var color, j, len, letter, piece, ref;
    this.piece = piece1;
    this.x = x1;
    this.y = y1;
    this.w = w;
    this.h = h;
    this.images = [];
    ref = this.piece;
    for (j = 0, len = ref.length; j < len; j++) {
      letter = ref[j];
      color = indexOf.call("KQRBNP", letter) >= 0 ? 'w' : 'b';
      piece = letter.toUpperCase();
      if (piece !== "K") {
        this.images.push(images[color + piece]);
      }
    }
    this.XOFFSET = -20 * this.images.length;
  }

  draw() {
    var i, j, len, ref, results;
    ref = range(this.images.length);
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      results.push(image(this.images[i], this.XOFFSET + this.x + 40 * i, YOFFSET + 360 + this.y, SIZE, SIZE));
    }
    return results;
  }

  inside(x, y) {
    var ref, ref1;
    return (this.x < (ref = x - this.XOFFSET) && ref < this.x + this.w) && (this.y < (ref1 = y - YOFFSET - 360) && ref1 < this.y + this.h);
  }

  click() {
    return window.location.href = "?base=" + this.piece;
  }

};

Square = class Square {
  constructor(index1, click) {
    this.index = index1;
    this.click = click;
    this.piece = "";
    this.i = this.index % 8;
    this.j = Math.floor(this.index / 8);
    this.x = this.i * SIZE;
    this.y = (7 - this.j) * SIZE;
    this.name = "abcdefgh"[this.i] + "12345678"[this.j];
  }

  draw() {
    fill((this.i + this.j) % 2 === 0 ? 'gray' : 'yellow');
    rect(this.x, YOFFSET + this.y, SIZE, SIZE);
    if (this.piece !== '') {
      return image(images[this.piece], this.x, YOFFSET + this.y, SIZE, SIZE);
    }
  }

  inside(x, y) {
    var ref;
    return (this.x < x && x < this.x + SIZE) && (this.y < (ref = y - YOFFSET) && ref < this.y + SIZE);
  }

};

Board = class Board {
  constructor() {
    var i, j, len, ref;
    this.squares = [];
    ref = range(64);
    for (j = 0, len = ref.length; j < len; j++) {
      i = ref[j];
      this.squares.push(new Square(i));
    }
  }

  draw() {
    var j, len, ref, results, square;
    ref = this.squares;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      square = ref[j];
      results.push(square.draw());
    }
    return results;
  }

  mousePressed() {
    var j, len, ref, results, square;
    ref = board.squares;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      square = ref[j];
      if (square.inside(mouseX, mouseY)) {
        results.push(clickedFrom = square.index);
      } else {
        results.push(void 0);
      }
    }
    return results;
  }

  mouseReleased() {
    var a, b, j, len, move, moves, ref, ref1, square;
    if (clickedFrom === -1) {
      return;
    }
    ref = board.squares;
    for (j = 0, len = ref.length; j < len; j++) {
      square = ref[j];
      if (square.inside(mouseX, mouseY)) {
        clickedTo = square.index;
      }
    }
    moves = (function() {
      var k, len1, ref1, results;
      ref1 = chess.moves({
        verbose: true
      });
      results = [];
      for (k = 0, len1 = ref1.length; k < len1; k++) {
        move = ref1[k];
        results.push(move.from + move.to);
      }
      return results;
    })();
    if (moves.length === 0) {
      getProblem(0);
      return;
    }
    a = board.squares[clickedFrom].name;
    b = board.squares[clickedTo].name;
    if (ref1 = a + b, indexOf.call(moves, ref1) >= 0) {
      chess.move({
        from: a,
        to: b
      });
      moveNumber += 1;
      fetchAI();
    }
    return clickedFrom = -1;
  }

};

draw = function() {
  var button, j, len;
  background('green');
  for (j = 0, len = buttons.length; j < len; j++) {
    button = buttons[j];
    button.draw();
  }
  board.draw();
  return setStatus();
};

mousePressed = function() {
  var button, j, len;
  for (j = 0, len = buttons.length; j < len; j++) {
    button = buttons[j];
    if (button.inside(mouseX, mouseY)) {
      button.click();
      return;
    }
  }
  return board.mousePressed();
};

mouseReleased = function() {
  return board.mouseReleased();
};

extractLastMove = function(s) {
  s = s.split("\n").slice(-2).join(' ');
  return s.split(' ').slice(-3).join(' ');
};

fetchAI = function() {
  return fetch('http://tablebase.lichess.ovh/standard?fen=' + chess.fen()).then((response) => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  }).then((data) => {
    echo(data);
    if (data.category === "draw") {
      return getProblem(-1);
    }
    if (data.moves.length === 0) {
      if (level < moveNumber) {
        return getProblem(-1);
      } else {
        return getProblem(+1);
      }
    }
    chess.move(data.moves[0].san);
    chess2board();
    return setStatus();
  }).catch((error) => {
    return echo('Fetch error:', error);
  });
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6Ii4uXFwiLCJzb3VyY2VzIjpbImNvZmZlZVxcc2tldGNoLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLE9BQUEsRUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsV0FBQSxFQUFBLFNBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLGVBQUEsRUFBQSxPQUFBLEVBQUEsVUFBQSxFQUFBLE1BQUEsRUFBQSxLQUFBLEVBQUEsWUFBQSxFQUFBLGFBQUEsRUFBQSxVQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxXQUFBLEVBQUEsS0FBQSxFQUFBLFNBQUEsRUFBQSxLQUFBLEVBQUEsS0FBQTtFQUFBOztBQUFBLElBQUEsR0FBTzs7QUFDUCxPQUFBLEdBQVU7O0FBRVYsSUFBQSxHQUFPLE1BSFA7O0FBS0EsS0FBQSxHQUFROztBQUNSLEtBQUEsR0FBUSxJQUFJLEtBQUosQ0FBQTs7QUFDUixLQUFBLEdBQVEsRUFQUjs7QUFRQSxVQUFBLEdBQWEsRUFSYjs7QUFVQSxLQUFBLEdBQVEsQ0FBQyxDQUFDOztBQUNWLElBQUEsR0FBTyxPQUFPLENBQUM7O0FBRWYsS0FBQSxHQUFROztBQUNSLEdBQUEsR0FBTTs7QUFFTixNQUFBLEdBQVMsQ0FBQTs7QUFDVCxXQUFBLEdBQWMsQ0FBQzs7QUFDZixTQUFBLEdBQVksQ0FBQzs7QUFFYixXQUFBLEdBQWM7O0FBRWQsT0FBQSxHQUFVOztBQUVWLFdBQUEsR0FBYyxRQUFBLENBQUEsQ0FBQTtBQUNkLE1BQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtBQUFJO0FBQUE7RUFBQSxLQUFBLHFDQUFBOztJQUNJLEVBQUEsR0FBSyxLQUFLLENBQUMsS0FBTixDQUFBLENBQWEsQ0FBQyxDQUFB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QUFHLElBQUksQ0FBQyxRQUFMLEtBQWlCLE1BQXBCO0FBQWdDLGFBQU8sVUFBQSxDQUFXLENBQUMsQ0FBWixFQUF2Qzs7SUFDQSxJQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBWCxLQUFxQixDQUF4QjtNQUNJLElBQUcsS0FBQSxHQUFRLFVBQVg7QUFDSSxlQUFPLFVBQUEsQ0FBVyxDQUFDLENBQVosRUFEWDtPQUFBLE1BQUE7QUFHSSxlQUFPLFVBQUEsQ0FBVyxDQUFDLENBQVosRUFIWDtPQURKOztJQUtBLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFELENBQUcsQ0FBQyxHQUF6QjtJQUNBLFdBQUEsQ0FBQTtXQUNBLFNBQUEsQ0FBQTtFQVZFLENBSlYsQ0FlSSxDQUFDLEtBZkwsQ0FlVyxDQUFDLEtBQUQsQ0FBQSxHQUFBO1dBQVcsSUFBQSxDQUFLLGNBQUwsRUFBcUIsS0FBckI7RUFBWCxDQWZYO0FBRE0iLCJzb3VyY2VzQ29udGVudCI6WyJTSVpFID0gNDBcclxuWU9GRlNFVCA9IDQwXHJcblxyXG5CQVNFID0gJ0tRaycgIyBIw6RtdGFzIGZyw6VuIFVSTC5cclxuXHJcbmJvYXJkID0gbnVsbFxyXG5jaGVzcyA9IG5ldyBDaGVzcygpXHJcbmxldmVsID0gMSAjIGZ1bGxNb3Zlc1xyXG5tb3ZlTnVtYmVyID0gMCAjIGNoZXNzLm1vdmVOdW1iZXIgdmVya2FyIGludGUgZmlubmFzLCBmw6VyIHLDpGtuYSBzasOkbHZcclxuXHJcbnJhbmdlID0gXy5yYW5nZVxyXG5lY2hvID0gY29uc29sZS5sb2dcclxuXHJcbnRpdGxlID0gbnVsbFxyXG5wZ24gPSBudWxsXHJcblxyXG5pbWFnZXMgPSB7fVxyXG5jbGlja2VkRnJvbSA9IC0xXHJcbmNsaWNrZWRUbyA9IC0xXHJcblxyXG5wcm9ibGVtQmFzZSA9IG51bGwgXHJcblxyXG5idXR0b25zID0gW11cclxuXHJcbmNoZXNzMmJvYXJkID0gLT5cclxuICAgIGZvciBpbmRleCBpbiByYW5nZSA2NFxyXG4gICAgICAgIHNxID0gY2hlc3MuYm9hcmQoKVs3IC0gaW5kZXggLy8gOF1baW5kZXggJSA4XVxyXG4gICAgICAgIGJvYXJkLnNxdWFyZXNbaW5kZXhdLnBpZWNlID0gaWYgc3EgdGhlbiBzcS5jb2xvciArIHNxLnR5cGUudG9VcHBlckNhc2UoKSBlbHNlICcnXHJcblxyXG5zZXRTdGF0dXMgPSAtPlxyXG4gICAgdGV4dFNpemUgMjBcclxuICAgIGZpbGwgJ2JsYWNrJ1xyXG4gICAgdGV4dCBcIk1hdGUgaW4gXCIgKyBsZXZlbCwgd2lkdGgvMiwyNVxyXG4gICAgcyA9IGlmIG1vdmVOdW1iZXIgPT0gMCB0aGVuIFwiRW5kYmFzZSBFeGVyY2lzZXIgYnkgQ2hyaXN0ZXJcIiBlbHNlIGV4dHJhY3RMYXN0TW92ZSBjaGVzcy5wZ24oKVxyXG4gICAgdGV4dCBzLHdpZHRoLzIsMzgwXHJcblxyXG5nZXRQcm9ibGVtID0gKGRlbHRhKSAtPlxyXG4gICAgbGV2ZWwgKz0gZGVsdGFcclxuICAgIG1vdmVOdW1iZXIgPSAwXHJcbiAgICBpZiBsZXZlbCA8IDEgdGhlbiBsZXZlbCA9IDFcclxuICAgIGlmIG5vdCBsZXZlbCBpbiBwcm9ibGVtQmFzZSB0aGVuIGxldmVsIC09IDFcclxuICAgIHByb2JsZW1zID0gcHJvYmxlbUJhc2VbbGV2ZWxdLnNwbGl0ICcgJ1xyXG4gICAgcHJvYmxlbSA9IF8uc2FtcGxlIHByb2JsZW1zXHJcbiAgICBpbmRleGVzID0gKHByb2JsZW0uc2xpY2UgMippLDIqaSsyIGZvciBpIGluIHJhbmdlIEJBU0UubGVuZ3RoKVxyXG4gICAgY2hlc3MuY2xlYXIoKVxyXG4gICAgZm9yIGkgaW4gcmFuZ2UgQkFTRS5sZW5ndGhcclxuICAgICAgICBsZXR0ZXIgPSBCQVNFW2ldXHJcbiAgICAgICAgY29sb3IgPSBpZiBsZXR0ZXIgaW4gXCJLUVJCTlBcIiB0aGVuICd3JyBlbHNlICdiJ1xyXG4gICAgICAgIGNoZXNzLnB1dCB7dHlwZTpsZXR0ZXIudG9Mb3dlckNhc2UoKSwgY29sb3I6Y29sb3J9LCBpbmRleGVzW2ldXHJcbiAgICAgICAgY2hlc3MyYm9hcmQoKVxyXG4gICAgICAgIHNldFN0YXR1cygpXHJcblxyXG5wcmVsb2FkID0gLT5cclxuICAgIGlmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzIFwiP2Jhc2U9XCIgdGhlbiBCQVNFID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoXCI9XCIpWzFdXHJcbiAgICBlY2hvIEJBU0VcclxuICAgIHByb2JsZW1CYXNlID0gbG9hZEpTT04gXCJqc29uLyN7QkFTRX0uanNvblwiXHJcbiAgICBmb3IgbGV0dGVyIGluIFwiS1FSQk5QXCJcclxuICAgICAgICBibGFjayA9ICdiJytsZXR0ZXJcclxuICAgICAgICB3aGl0ZSA9ICd3JytsZXR0ZXJcclxuICAgICAgICBpbWFnZXNbYmxhY2tdID0gbG9hZEltYWdlIFwiaW1nLyN7YmxhY2t9LnBuZ1wiXHJcbiAgICAgICAgaW1hZ2VzW3doaXRlXSA9IGxvYWRJbWFnZSBcImltZy8je3doaXRlfS5wbmdcIlxyXG5cclxuc2V0dXAgPSAtPlxyXG4gICAgY3JlYXRlQ2FudmFzIDgqU0laRSwgNzAwXHJcblxyXG4gICAgdGV4dEFsaWduIENFTlRFUixDRU5URVJcclxuXHJcbiAgICBib2FyZCA9IG5ldyBCb2FyZCgpXHJcbiAgICB0aXRsZSA9IGNyZWF0ZURpdigpXHJcbiAgICB0aXRsZS5wb3NpdGlvbiAyNSwgMTIuNSpTSVpFXHJcbiAgICBwZ24gPSBjcmVhdGVEaXYgJydcclxuICAgIHBnbi5wb3NpdGlvbiAyNSwgMTMqU0laRVxyXG4gICAgZ2V0UHJvYmxlbSAwXHJcblxyXG4gICAgYnV0dG9ucy5wdXNoIG5ldyBCdXR0b24gJ0tRaycsd2lkdGgvMiwwLDEwMCw0MFxyXG4gICAgYnV0dG9ucy5wdXNoIG5ldyBCdXR0b24gJ0tSaycsd2lkdGgvMiw1MCwxMDAsNDBcclxuICAgIGJ1dHRvbnMucHVzaCBuZXcgQnV0dG9uICdLUWtyJyx3aWR0aC8yLDEwMCwxMDAsNDBcclxuICAgIGJ1dHRvbnMucHVzaCBuZXcgQnV0dG9uICdLQkJrJyx3aWR0aC8yLDE1MCwxMDAsNDBcclxuICAgIGJ1dHRvbnMucHVzaCBuZXcgQnV0dG9uICdLQk5rJyx3aWR0aC8yLDIwMCwxMDAsNDBcclxuICAgIGJ1dHRvbnMucHVzaCBuZXcgQnV0dG9uICdLTk5Oaycsd2lkdGgvMiwyNTAsMTAwLDQwXHJcblxyXG5jbGFzcyBCdXR0b25cclxuICAgIGNvbnN0cnVjdG9yIDogKEBwaWVjZSxAeCxAeSxAdyxAaCkgLT5cclxuICAgICAgICBAaW1hZ2VzID0gW11cclxuICAgICAgICBmb3IgbGV0dGVyIGluIEBwaWVjZVxyXG4gICAgICAgICAgICBjb2xvciA9IGlmIGxldHRlciBpbiBcIktRUkJOUFwiIHRoZW4gJ3cnIGVsc2UgJ2InXHJcbiAgICAgICAgICAgIHBpZWNlID0gbGV0dGVyLnRvVXBwZXJDYXNlKClcclxuICAgICAgICAgICAgaWYgcGllY2UgIT0gXCJLXCIgdGhlbiBAaW1hZ2VzLnB1c2ggaW1hZ2VzW2NvbG9yICsgcGllY2VdXHJcbiAgICAgICAgQFhPRkZTRVQgPSAtMjAgKiBAaW1hZ2VzLmxlbmd0aFxyXG4gICAgZHJhdyA6IC0+XHJcbiAgICAgICAgZm9yIGkgaW4gcmFuZ2UgQGltYWdlcy5sZW5ndGhcclxuICAgICAgICAgICAgaW1hZ2UgQGltYWdlc1tpXSxAWE9GRlNFVCtAeCs0MCppLFlPRkZTRVQrMzYwK0B5LFNJWkUsU0laRVxyXG4gICAgICAgICAgICBcclxuICAgIGluc2lkZTogKHgseSkgLT4gQHggPCB4LUBYT0ZGU0VUIDwgQHgrQHcgYW5kIEB5IDwgeS1ZT0ZGU0VULTM2MCA8IEB5K0BoXHJcbiAgICBjbGljayA6IC0+IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCI/YmFzZT1cIiArIEBwaWVjZVxyXG5cclxuY2xhc3MgU3F1YXJlXHJcbiAgICBjb25zdHJ1Y3RvciA6IChAaW5kZXgsQGNsaWNrKSAtPlxyXG4gICAgICAgIEBwaWVjZSA9IFwiXCJcclxuICAgICAgICBAaSA9IEBpbmRleCAlIDhcclxuICAgICAgICBAaiA9IEBpbmRleCAvLyA4XHJcbiAgICAgICAgQHggPSBAaSAqIFNJWkVcclxuICAgICAgICBAeSA9ICg3LUBqKSAqIFNJWkVcclxuICAgICAgICBAbmFtZSA9IFwiYWJjZGVmZ2hcIltAaV0gKyBcIjEyMzQ1Njc4XCJbQGpdXHJcbiAgICBkcmF3IDogLT5cclxuICAgICAgICBmaWxsIGlmIChAaStAaikgJSAyID09IDAgdGhlbiAnZ3JheScgZWxzZSAneWVsbG93J1xyXG4gICAgICAgIHJlY3QgQHgsWU9GRlNFVCtAeSxTSVpFLFNJWkVcclxuICAgICAgICBpZiBAcGllY2UgIT0gJycgIHRoZW4gaW1hZ2UgaW1hZ2VzW0BwaWVjZV0sQHgsWU9GRlNFVCtAeSxTSVpFLFNJWkVcclxuICAgIGluc2lkZTogKHgseSkgLT4gQHggPCB4IDwgQHgrU0laRSBhbmQgQHkgPCB5LVlPRkZTRVQgPCBAeStTSVpFXHJcblxyXG5jbGFzcyBCb2FyZFxyXG4gICAgY29uc3RydWN0b3IgOiAtPlxyXG4gICAgICAgIEBzcXVhcmVzID0gW11cclxuICAgICAgICBmb3IgaSBpbiByYW5nZSA2NFxyXG4gICAgICAgICAgICBAc3F1YXJlcy5wdXNoIG5ldyBTcXVhcmUoaSlcclxuICAgIGRyYXcgOiAtPlxyXG4gICAgICAgIGZvciBzcXVhcmUgaW4gQHNxdWFyZXNcclxuICAgICAgICAgICAgc3F1YXJlLmRyYXcoKVxyXG4gICAgbW91c2VQcmVzc2VkIDogLT5cclxuICAgICAgICBmb3Igc3F1YXJlIGluIGJvYXJkLnNxdWFyZXNcclxuICAgICAgICAgICAgaWYgc3F1YXJlLmluc2lkZSBtb3VzZVgsbW91c2VZIHRoZW4gY2xpY2tlZEZyb20gPSBzcXVhcmUuaW5kZXhcclxuICAgIG1vdXNlUmVsZWFzZWQgOiAtPlxyXG4gICAgICAgIGlmIGNsaWNrZWRGcm9tID09IC0xIHRoZW4gcmV0dXJuXHJcbiAgICAgICAgZm9yIHNxdWFyZSBpbiBib2FyZC5zcXVhcmVzXHJcbiAgICAgICAgICAgIGlmIHNxdWFyZS5pbnNpZGUgbW91c2VYLG1vdXNlWSB0aGVuIGNsaWNrZWRUbyA9IHNxdWFyZS5pbmRleFxyXG4gICAgICAgIG1vdmVzID0gKG1vdmUuZnJvbSArIG1vdmUudG8gZm9yIG1vdmUgaW4gY2hlc3MubW92ZXMgeyB2ZXJib3NlOiB0cnVlIH0pXHJcbiAgICAgICAgaWYgbW92ZXMubGVuZ3RoID09IDBcclxuICAgICAgICAgICAgZ2V0UHJvYmxlbSAwXHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIGEgPSBib2FyZC5zcXVhcmVzW2NsaWNrZWRGcm9tXS5uYW1lXHJcbiAgICAgICAgYiA9IGJvYXJkLnNxdWFyZXNbY2xpY2tlZFRvXS5uYW1lXHJcbiAgICAgICAgaWYgYSArIGIgaW4gbW92ZXNcclxuICAgICAgICAgICAgY2hlc3MubW92ZSB7IGZyb206IGEsIHRvOiBiIH1cclxuICAgICAgICAgICAgbW92ZU51bWJlciArPSAxXHJcbiAgICAgICAgICAgIGZldGNoQUkoKVxyXG4gICAgICAgIGNsaWNrZWRGcm9tID0gLTFcclxuXHJcbmRyYXcgPSAtPiBcclxuICAgIGJhY2tncm91bmQgJ2dyZWVuJ1xyXG4gICAgZm9yIGJ1dHRvbiBpbiBidXR0b25zXHJcbiAgICAgICAgYnV0dG9uLmRyYXcoKVxyXG4gICAgYm9hcmQuZHJhdygpXHJcbiAgICBzZXRTdGF0dXMoKVxyXG5cclxubW91c2VQcmVzc2VkID0gLT4gXHJcbiAgICBmb3IgYnV0dG9uIGluIGJ1dHRvbnNcclxuICAgICAgICBpZiBidXR0b24uaW5zaWRlIG1vdXNlWCwgbW91c2VZXHJcbiAgICAgICAgICAgIGJ1dHRvbi5jbGljaygpXHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgYm9hcmQubW91c2VQcmVzc2VkKClcclxubW91c2VSZWxlYXNlZCA9IC0+IGJvYXJkLm1vdXNlUmVsZWFzZWQoKVxyXG5cclxuZXh0cmFjdExhc3RNb3ZlID0gKHMpIC0+XHJcbiAgICBzID0gcy5zcGxpdChcIlxcblwiKS5zbGljZSgtMikuam9pbignICcpXHJcbiAgICBzLnNwbGl0KCcgJykuc2xpY2UoLTMpLmpvaW4gJyAnXHJcbiAgICBcclxuZmV0Y2hBSSA9IC0+IFxyXG4gICAgZmV0Y2ggJ2h0dHA6Ly90YWJsZWJhc2UubGljaGVzcy5vdmgvc3RhbmRhcmQ/ZmVuPScgKyBjaGVzcy5mZW4oKVxyXG4gICAgICAgIC50aGVuIChyZXNwb25zZSkgPT4gXHJcbiAgICAgICAgICAgIGlmICFyZXNwb25zZS5vayB0aGVuIHRocm93IG5ldyBFcnJvciAnTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rJ1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpXHJcbiAgICAgICAgLnRoZW4gKGRhdGEpID0+XHJcbiAgICAgICAgICAgIGVjaG8gZGF0YVxyXG4gICAgICAgICAgICBpZiBkYXRhLmNhdGVnb3J5ID09IFwiZHJhd1wiIHRoZW4gcmV0dXJuIGdldFByb2JsZW0gLTFcclxuICAgICAgICAgICAgaWYgZGF0YS5tb3Zlcy5sZW5ndGggPT0gMFxyXG4gICAgICAgICAgICAgICAgaWYgbGV2ZWwgPCBtb3ZlTnVtYmVyXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByb2JsZW0gLTFcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJvYmxlbSArMVxyXG4gICAgICAgICAgICBjaGVzcy5tb3ZlIGRhdGEubW92ZXNbMF0uc2FuXHJcbiAgICAgICAgICAgIGNoZXNzMmJvYXJkKClcclxuICAgICAgICAgICAgc2V0U3RhdHVzKClcclxuICAgICAgICAuY2F0Y2ggKGVycm9yKSA9PiBlY2hvICdGZXRjaCBlcnJvcjonLCBlcnJvclxyXG4iXX0=
//# sourceURL=c:\github\2024\005-KRK-minimax\coffee\sketch.coffee