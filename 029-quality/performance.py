ocrs = []
def app(a,b,c):
	ocrs.append([a,b,c]) # id, opps, result

# FairPair 2024-10-30
# elos = [1612,1425,1598,1666,1884,1815,1713,1570,1603,1815,1693,1476,1771,1801]
# app( 7,[13, 4,11,10],4)
# app( 8,[ 3,12, 2, 1],4)
# app( 6,[ 5,14,10,11],3)
# app( 2,[12, 9, 8,14],3)
# app(10,[14, 5, 6, 7],2)
# app( 5,[ 6,10,14,13],2)
# app(13,[ 7,11, 4, 5],2)
# app( 4,[11, 7,13, 9],2)
# app( 9,[ 1, 2, 3, 4],2)
# app( 3,[ 8, 1, 9,12],1.5)
# app( 1,[ 9, 3,12, 8],1.5)
# app(12,[ 2, 8, 1, 3],1)
# app(14,[10, 6, 5, 2],0)
# app(11,[ 4,13, 7, 6],0)
#############################

# Lilla Stockholm GP 2024-11-01
# ZERO = 1400
# elos = [1593,1644,1699,1577,1579,1635,1724,1566,1551,1657,
#  		1639,1672,1678,ZERO,ZERO,ZERO,1539,ZERO,ZERO,ZERO,
#  		ZERO,ZERO,ZERO,1504,1594,1589,1513,1439]
#
# app(1,[20,3,2,13,11,4,6,7],6) # Tuva
# app(2,[18,22,1,4,12,13,3,6],6)
# app(3,[17,1,20,21,6,12,2,4],6)
# app(4,[23,12,6,2,5,1,7,3],5.5)
# app(5,[16,13,10,7,4,11,19,12],5.5)
# app(6,[15,7,4,14,3,17,1,2],5)
# app(7,[9,6,14,5,18,8,4,1],5)
# app(8,[22,15,11,20,14,7,21,17],5)
# app(9,[7,20,17,24,16,25,22,15],5)
# app(10,[28,21,5,17,27,23,14,11],5)
# app(11,[19,14,8,22,1,5,13,10],4.5)
# app(12,[24,4,16,25,2,3,17,5],4.5)
# app(13,[27,5,21,1,19,2,11,24],4.5)
# app(14,[26,11,7,6,8,27,10,21],4)
# app(15,[6,8,28,23,26,20,18,9],4)
# app(16,[5,27,12,18,9,28,23,20],4)
# app(17,[3,19,9,10,21,6,12,8],3.5)
# app(18,[2,26,24,16,7,21,15,22],3.5)
# app(19,[11,17,27,26,13,22,5],3.5)
# app(20,[1,9,3,8,23,15,27,16],3)
# app(21,[25,10,13,3,17,18,8,14],3)
# app(22,[8,2,26,11,25,19,9,18],3)
# app(23,[4,24,25,15,20,10,16,28],3)
# app(24,[12,23,18,9,28,26,25,13],3)
# app(25,[21,28,23,12,22,9,24,26],3)
# app(26,[14,18,22,19,15,24,28,25],1.5)
# app(27,[13,16,19,28,10,14,20],1)
# app(28,[10,25,15,27,16,26,23],0.5)

##############################################

# Tyresö Open 2024
elos = [2416,2366,2272,2413,2235,
        2093,2048,2035,2141,1793,
        2076,2335,1923,2113,2213,
        2108,1977,1907,1936,2065,
        1818,2039,2109,1985,1944,
        2046,1897,2031,2022,1871,
        1748,1896,1846,1880,1886,
        2001,1827,1691,1803,1893,
        1878,1641,1400,1768,1728,
        1787,1761,1796,1400,1954,
        1733,1889,1835,1852,1480,
        1733,1800,1783,1726,1778,
        1885,1828,1622,1794,1400,
        1848,1709,1650,1575,1671,
        1833,1624,1680,1721,1763,
        1688,1695,1417,1579,1524,1406,1400]
app(1,[53,24, 8,16,15,14, 2, 5],6.5)
app(2,[62,50,28, 6,14, 5, 1, 4],6.5)
app(3,[21,19,46,54,28,18,16,11],6.5)
app(4,[71,36,70,61, 8,15,14, 2],6.5)
app(5,[39,17,25,22, 9, 2,23, 1],6.0)
app(6,[58,35,30, 2,10,17,34,14],6.0)
app(7,[75,41,52,14,38,29,18,15],6.0)
app(8,[51,37, 1,34, 4,21,10,30],5.5)
app(9,[48,25,17,12, 5,28,11,29],5.5)
app(10,[16,77,26,36, 6,20, 8,28],5.5)
app(11,[60,61,19,15,35,16, 9, 3],5.5)
app(12,[37,45,21, 9,62,40,17,20],5.5)
app(13,[70,42,57,43,23,51,50,36],5.5)
app(14,[64,27,36, 7, 2, 1, 4, 6],5.0)
app(15,[57,18,29,11, 1, 4,25, 7],5.0)
app(16,[10,40,34, 1,19,11, 3,17],5.0)
app(17,[67, 5, 9,70,31, 6,12,16],5.0)
app(18,[68,15,47,51,22, 3, 7,37],5.0)
app(19,[76, 3,11,44,16,31,35,41],5.0)
app(20,[44,34,37,30,33,10,32,12],5.0)
app(21,[ 3,76,12,55,27, 8,61,50],5.0)
app(22,[31,54,42, 5,18,35,29,34],5.0)
app(23,[46,52,60,56,13,38, 5,24],5.0)
app(24,[74, 1,44,47,37,39,43,23],5.0)
app(25,[77, 9, 5,63,56,41,15,35],5.0)
app(26,[47,30,10,75,70,33,38,40],5.0)
app(27,[72,14,51,45,21,58,53,48],5.0)
app(28,[56,33, 2,53, 3, 9,39,10],4.5)
app(29,[45,73,15,33,30, 7,22, 9],4.5)
app(30,[81,26, 6,20,29,64,31, 8],4.5)
app(31,[22,49,32,50,17,19,30,55],4.5)
app(32,[42,43,31,46,59,48,20,33],4.5)
app(33,[65,28,72,29,20,26,63,32],4.5)
app(34,[55,20,16, 8,63,36, 6,22],4.0)
app(35,[69, 6,59,42,11,22,19,25],4.0)
app(36,[59, 4,14,10,53,34,62,13],4.0)
app(37,[12, 8,20,73,24,77,52,18],4.0)
app(38,[50,62,41,52, 7,23,26,39],4.0)
app(39,[ 5,59,79,49,52,24,28,38],4.0)
app(40,[63,16,56,60,42,12,57,26],4.0)
app(41,[78, 7,38,74,44,25,49,19],4.0)
app(42,[32,13,22,35,40,57,70,66],4.0)
app(43,[66,32,68,13,71,54,24,45],4.0)
app(44,[20,69,24,19,41,52,73,61],4.0)
app(45,[29,12,78,27,55,76,54,43],4.0)
app(46,[23,79, 3,32,68,49,74,63],4.0)
app(47,[26,55,18,24,79,61,65,62],4.0)
app(48,[ 9,67,69,65,61,32,66,27],4.0)
app(49,[54,31,82,39,74,46,41,64],4.0)
app(50,[38, 2,75,31,64,60,13,21],3.5)
app(51,[ 8,81,27,18,54,13,64,57],3.5)
app(52,[79,23, 7,38,39,44,37,58],3.5)
app(53,[ 1,74,65,28,36,59,27,56],3.5)
app(54,[49,22,73, 3,51,43,45,72],3.5)
app(55,[34,47,58,21,45,70,60,31],3.5)
app(56,[28,71,40,23,25,66,67,53],3.5)
app(57,[15,68,13,71,72,42,40,51],3.5)
app(58,[ 6,63,55,69,73,27,77,52],3.5)
app(59,[36,39,35,66,32,53,71,74],3.5)
app(60,[11,80,23,40,75,50,55,71],3.5)
app(61,[80,11,67, 4,48,47,21,44],3.0)
app(62,[ 2,38,76,72,12,67,36,47],3.0)
app(63,[40,58,66,25,34,75,33,46],3.0)
app(64,[14,72,80,67,50,30,51,49],3.0)
app(65,[33,82,53,48,67,68,47,75],3.0)
app(66,[43,70,63,59,76,56,48,42],3.0)
app(67,[17,48,61,64,65,62,56,73],3.0)
app(68,[18,57,43,77,46,65,78,79],3.0)
app(69,[35,44,48,58,80,72,82,76],3.0)
app(70,[13,66, 4,17,26,55,42,80],2.5)
app(71,[ 4,56,77,57,43,79,59,60],2.5)
app(72,[27,64,33,62,57,69,80,54],2.5)
app(73,[82,29,54,37,58,81,44,67],2.0)
app(74,[24,53,81,41,49,78,46,59],2.0)
app(75,[ 7,78,50,26,60,63,79,65],2.0)
app(76,[19,21,62,78,66,45,81,69],2.0)
app(77,[25,10,71,68,81,37,58,82],2.0)
app(78,[41,75,45,76,82,74,68,81],2.0)
app(79,[52,46,39,80,47,71,75,68],1.5)
app(80,[61,60,64,79,69,82,72,70],1.5)
app(81,[30,51,74,82,77,73,76,78],1.0)
app(82,[73,65,49,81,78,80,69,77],0.0) # Frirond

##########################################

def expected_score(ratings, own_rating):
	return sum(1 / (1 + 10**((rating - own_rating) / 400)) for rating in ratings)
assert expected_score([1700],1800) == 0.6400649998028851
assert expected_score([1800],1700) == 0.35993500019711494
assert expected_score([1800,1800],1700) == 0.7198700003942299
assert expected_score([1700,1700],1800) == 1.2801299996057702

def average(ratings): return sum(ratings)/len(ratings)
assert average([1771,1666,1693,1815]) == 1736.25

def performance(opponent_ratings, score):
	lo, hi = 0, 4000
	while hi - lo > 0.001:
		mid = (lo + hi) / 2
		if expected_score(opponent_ratings, mid) > score:
			hi = mid
		else:
			lo = mid
	return round(mid,1)

assert performance([1771,1666,1693,1815],3.5) == 2082.0
assert performance([1771,1666,1693,1815,1736.25],4) == 1982.0
assert performance([1771,1666,1693,1815],4) == 4000.0
assert performance([1771,1666,1693,1815,1736.25],4.5) == 2124.5

def enhanced(opponent_ratings, score, fiktiv_remi):
	# fiktiv_remi = average(opponent_ratings)
	res = performance(opponent_ratings + [fiktiv_remi], score + 0.5)
	return round(res,1)
assert enhanced([1771,1666,1693,1815],3.5,1736.25) == 1982.0
assert enhanced([1771,1666,1693,1815],4.0,1736.25) == 2124.5

sorter = []
# I första hand på PR
# I andra hande på EPR

for i in range(len(elos)):
	ior = ocrs[i]
	elo = elos[ior[0] - 1]
	opps = ior[1]
	res = ior[2]
	ratings = [elos[opp-1] for opp in opps]
	medel = average(ratings) # local average
	sorter.append([performance(ratings,res), enhanced(ratings,res,medel), i])

sorter.sort()
sorter.reverse()

for [p,e,i] in sorter:
	ior = ocrs[i]
	elo = elos[ior[0] - 1]
	opps = ior[1]
	res = ior[2]
	ratings = [str(elos[opp - 1]) for opp in opps]
	s = str(i+1)
	if len(s)==1: s=' '+s
	a = round(average([elos[opp - 1] for opp in opps]),1)
	# print()
	print(s, f"{elo:.1f}", '['+" ".join(ratings)+']', p, e, a, f"{res:.1f}")

################################


# elos = [2343,2363,2156,2044,1876,
# 		2000,2110,2066,2046,1893,
# 		1914,1882,1616,2178,1660,
# 		1783,1955,1802,1699,1615,
# 		1600,1576,1862,1590,1580,
# 		1570,1849,1560,1550,1540]
#
# app([16,10, 4, 8, 2, 3, 7],"1111111")
# app([18,11, 9, 7, 1, 8, 4],"111r011")
# app([15, 5,19,10, 7, 1,12],"1011101")
# app([25,24, 1,16,14, 5, 2],"1101110")
# app([29, 3, 8, 9,17, 4,11],"1101101")
# app([12, 9,18,11,16,10, 8],"1010111")
# app([13,23,17, 2, 3, 9, 1],"111r010")
# app([20,19, 5, 1,11, 2, 6],"1110100")
# app([22, 6, 2, 5,13, 7,16],"1100101")
# app([28, 1,13, 3,20, 6,19],"1010101")
# app([30, 2,15, 6, 8,23, 5],"1011010")
# app([ 6,22,20,25,21,17, 3],"0101110")
# app([ 7,29,10,27, 9,21,17],"0101011")
# app([19,17,30,23, 4,15,18],"0011011")
# app([ 3,28,11,24,27,14,25],"010r101")
# app([ 1,30,24, 4, 6,20, 9],"0110010")
# app([26,14, 7,20, 5,12,13],"1101000")
# app([ 2,26, 6,22,23,24,14],"0101010")
# app([14, 8, 3,21,29,22,10],"1000110")
# app([ 8,21,12,17,10,16,29],"0110001")
# app([23,20,26,19,12,13,28],"0011001")
# app([ 9,12,29,18,26,19,30],"0010101")
# app([21, 7,25,14,18,11,24],"10r010r")
# app([27, 4,16,15,25,18,23],"100r10r")
# app([ 4,27,23,12,24,26,15],"01r0010")
# app([17,18,21,28,22,25,27],"0001001")
# app([24,25,28,13,15,30,26],"0010010")
# app([10,15,27,26,30,29,21],"0000110")
# app([ 5,13,22,30,19,28,20],"0001000")
# app([11,16,14,29,28,27,22],"0000000")


##################################

